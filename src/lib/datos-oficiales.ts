/**
 * DATOS OFICIALES - Sistema de Pensiones Chile
 * Fuente: Superintendencia de Pensiones y CMF
 * Actualización: Octubre 2025
 * 
 * Este archivo contiene las tablas de mortalidad TM-2020 oficiales
 * y las tasas de rentas vitalicias publicadas por la SPensiones.
 */

// ==========================================
// TABLAS DE MORTALIDAD TM-2020 OFICIALES
// ==========================================

/**
 * CB-H-2020: Tabla de mortalidad para Hombres (Vejez - Retiro Programado)
 * Causantes y Beneficiarios no inválidos hombres
 * Fuente: CMF-SP, Tablas TM-2020
 */
export const TABLA_CB_H_2020: Record<number, number> = {
  0: 0.006154, 1: 0.000331, 2: 0.000200, 3: 0.000145, 4: 0.000117, 5: 0.000117,
  6: 0.000109, 7: 0.000100, 8: 0.000091, 9: 0.000083, 10: 0.000077,
  11: 0.000086, 12: 0.000112, 13: 0.000158, 14: 0.000226, 15: 0.000314,
  16: 0.000409, 17: 0.000499, 18: 0.000576, 19: 0.000642, 20: 0.000703,
  21: 0.000763, 22: 0.000824, 23: 0.000892, 24: 0.000966, 25: 0.001045,
  26: 0.001129, 27: 0.001217, 28: 0.001311, 29: 0.001413, 30: 0.001524,
  31: 0.001647, 32: 0.001783, 33: 0.001935, 34: 0.002103, 35: 0.002285,
  36: 0.002483, 37: 0.002694, 38: 0.002918, 39: 0.003157, 40: 0.003414,
  41: 0.003692, 42: 0.003996, 43: 0.004332, 44: 0.004704, 45: 0.005118,
  46: 0.005578, 47: 0.006087, 48: 0.006646, 49: 0.007254, 50: 0.007909,
  51: 0.008609, 52: 0.009352, 53: 0.010140, 54: 0.010979, 55: 0.011878,
  56: 0.012847, 57: 0.013896, 58: 0.015039, 59: 0.016289, 60: 0.017661,
  61: 0.019171, 62: 0.020831, 63: 0.022651, 64: 0.024636, 65: 0.026790,
  66: 0.029115, 67: 0.031610, 68: 0.034277, 69: 0.037124, 70: 0.040169,
  71: 0.043432, 72: 0.046937, 73: 0.050711, 74: 0.054782, 75: 0.059178,
  76: 0.063921, 77: 0.069032, 78: 0.074524, 79: 0.080407, 80: 0.086692,
  81: 0.093389, 82: 0.100513, 83: 0.108087, 84: 0.116142, 85: 0.124720,
  86: 0.133865, 87: 0.143626, 88: 0.154050, 89: 0.165176, 90: 0.176997,
  91: 0.189475, 92: 0.202548, 93: 0.216137, 94: 0.230145, 95: 0.244468,
  96: 0.258995, 97: 0.273625, 98: 0.288258, 99: 0.302809, 100: 0.317193,
  101: 0.331341, 102: 0.345187, 103: 0.358679, 104: 0.371773, 105: 0.384432,
  106: 0.396623, 107: 0.408321, 108: 0.419504, 109: 0.430157, 110: 1.000000
};

/**
 * B-M-2020: Tabla de mortalidad para Mujeres (Vejez - Retiro Programado)
 * Beneficiarias no inválidas
 * Fuente: CMF-SP, Tablas TM-2020
 */
export const TABLA_B_M_2020: Record<number, number> = {
  0: 0.005207, 1: 0.000268, 2: 0.000182, 3: 0.000134, 4: 0.000106, 5: 0.000092,
  6: 0.000081, 7: 0.000070, 8: 0.000062, 9: 0.000057, 10: 0.000055,
  11: 0.000061, 12: 0.000078, 13: 0.000106, 14: 0.000147, 15: 0.000201,
  16: 0.000269, 17: 0.000351, 18: 0.000447, 19: 0.000553, 20: 0.000667,
  21: 0.000787, 22: 0.000912, 23: 0.001040, 24: 0.001171, 25: 0.001304,
  26: 0.001438, 27: 0.001574, 28: 0.001714, 29: 0.001859, 30: 0.002010,
  31: 0.002170, 32: 0.002341, 33: 0.002524, 34: 0.002720, 35: 0.002929,
  36: 0.003151, 37: 0.003385, 38: 0.003632, 39: 0.003891, 40: 0.004163,
  41: 0.004449, 42: 0.004752, 43: 0.005075, 44: 0.005420, 45: 0.005791,
  46: 0.006191, 47: 0.006621, 48: 0.007081, 49: 0.007571, 50: 0.008089,
  51: 0.008636, 52: 0.009211, 53: 0.009815, 54: 0.010450, 55: 0.011119,
  56: 0.011826, 57: 0.012576, 58: 0.013376, 59: 0.014231, 60: 0.015147,
  61: 0.016129, 62: 0.017181, 63: 0.018307, 64: 0.019508, 65: 0.020785,
  66: 0.022137, 67: 0.023564, 68: 0.025066, 69: 0.026646, 70: 0.028311,
  71: 0.030070, 72: 0.031934, 73: 0.033915, 74: 0.036025, 75: 0.038273,
  76: 0.040666, 77: 0.043208, 78: 0.045899, 79: 0.048740, 80: 0.051733,
  81: 0.054886, 82: 0.058211, 83: 0.061722, 84: 0.065435, 85: 0.069370,
  86: 0.073551, 87: 0.078006, 88: 0.082765, 89: 0.087859, 90: 0.093317,
  91: 0.099167, 92: 0.105434, 93: 0.112139, 94: 0.119300, 95: 0.126928,
  96: 0.135031, 97: 0.143611, 98: 0.152668, 99: 0.162198, 100: 0.172190,
  101: 0.182633, 102: 0.193513, 103: 0.204816, 104: 0.216526, 105: 0.228627,
  106: 0.241101, 107: 0.253930, 108: 0.267093, 109: 0.280573, 110: 1.000000
};

/**
 * MI-H-2020: Tabla de mortalidad para Invalidez Hombres
 * Causantes y Beneficiarios inválidos hombres
 * Tasas más altas por condición de invalidez
 */
export const TABLA_MI_H_2020: Record<number, number> = {
  0: 0.006154, 1: 0.001299, 2: 0.000787, 3: 0.000580, 4: 0.000497, 5: 0.000493,
  6: 0.000475, 7: 0.000450, 8: 0.000423, 9: 0.000397, 10: 0.000375,
  11: 0.000412, 12: 0.000535, 13: 0.000755, 14: 0.001083, 15: 0.001504,
  16: 0.001960, 17: 0.002391, 18: 0.002760, 19: 0.003076, 20: 0.003369,
  21: 0.003655, 22: 0.003948, 23: 0.004273, 24: 0.004628, 25: 0.005007,
  26: 0.005409, 27: 0.005832, 28: 0.006284, 29: 0.006772, 30: 0.007302,
  31: 0.007885, 32: 0.008533, 33: 0.009259, 34: 0.010074, 35: 0.010986,
  36: 0.012001, 37: 0.013123, 38: 0.014355, 39: 0.015699, 40: 0.017159,
  41: 0.018742, 42: 0.020462, 43: 0.022334, 44: 0.024376, 45: 0.026610,
  46: 0.029062, 47: 0.031759, 48: 0.034730, 49: 0.038006, 50: 0.041618,
  51: 0.045597, 52: 0.049970, 53: 0.054761, 54: 0.059989, 55: 0.065671,
  56: 0.071818, 57: 0.078440, 58: 0.085546, 59: 0.093142, 60: 0.101236,
  61: 0.109836, 62: 0.118956, 63: 0.128613, 64: 0.138829, 65: 0.149629,
  66: 0.161041, 67: 0.173094, 68: 0.185818, 69: 0.199241, 70: 0.213389,
  71: 0.228284, 72: 0.243945, 73: 0.260383, 74: 0.277604, 75: 0.295604,
  76: 0.314377, 77: 0.333907, 78: 0.354174, 79: 0.375153, 80: 0.396815,
  81: 0.419127, 82: 0.442047, 83: 0.465526, 84: 0.489508, 85: 0.513933,
  86: 0.538735, 87: 0.563842, 88: 0.589177, 89: 0.614651, 90: 0.640166,
  91: 0.665613, 92: 0.690878, 93: 0.715839, 94: 0.740369, 95: 0.764334,
  96: 0.787597, 97: 0.810016, 98: 0.831450, 99: 0.851757, 100: 0.870793,
  101: 0.888419, 102: 0.904497, 103: 0.918894, 104: 0.931482, 105: 0.942137,
  106: 0.950743, 107: 0.957194, 108: 0.961395, 109: 0.963272, 110: 1.000000
};

/**
 * MI-M-2020: Tabla de mortalidad para Invalidez Mujeres
 * Causantes y Beneficiarias inválidas
 */
export const TABLA_MI_M_2020: Record<number, number> = {
  0: 0.005207, 1: 0.002980, 2: 0.002030, 3: 0.001490, 4: 0.001230, 5: 0.001120,
  6: 0.001030, 7: 0.000950, 8: 0.000880, 9: 0.000820, 10: 0.000780,
  11: 0.000850, 12: 0.001040, 13: 0.001380, 14: 0.001870, 15: 0.002520,
  16: 0.003270, 17: 0.004100, 18: 0.004980, 19: 0.005880, 20: 0.006780,
  21: 0.007680, 22: 0.008590, 23: 0.009550, 24: 0.010560, 25: 0.011620,
  26: 0.012730, 27: 0.013890, 28: 0.015110, 29: 0.016390, 30: 0.017740,
  31: 0.019170, 32: 0.020700, 33: 0.022330, 34: 0.024080, 35: 0.025950,
  36: 0.027950, 37: 0.030080, 38: 0.032350, 39: 0.034760, 40: 0.037310,
  41: 0.040010, 42: 0.042870, 43: 0.045900, 44: 0.049120, 45: 0.052540,
  46: 0.056180, 47: 0.060060, 48: 0.064200, 49: 0.068610, 50: 0.073310,
  51: 0.078310, 52: 0.083630, 53: 0.089280, 54: 0.095280, 55: 0.101640,
  56: 0.108380, 57: 0.115510, 58: 0.123050, 59: 0.131010, 60: 0.139410,
  61: 0.148260, 62: 0.157580, 63: 0.167380, 64: 0.177680, 65: 0.188500,
  66: 0.199860, 67: 0.211780, 68: 0.224280, 69: 0.237380, 70: 0.251100,
  71: 0.265470, 72: 0.280510, 73: 0.296240, 74: 0.312680, 75: 0.329850,
  76: 0.347780, 77: 0.366480, 78: 0.385970, 79: 0.406260, 80: 0.427370,
  81: 0.449300, 82: 0.472050, 83: 0.495620, 84: 0.520000, 85: 0.545180,
  86: 0.571140, 87: 0.597860, 88: 0.625310, 89: 0.653460, 90: 0.682270,
  91: 0.711700, 92: 0.741700, 93: 0.772210, 94: 0.803160, 95: 0.834480,
  96: 0.866080, 97: 0.897870, 98: 0.929730, 99: 0.961520, 100: 0.993060,
  101: 0.996480, 102: 0.998680, 103: 0.999590, 104: 0.999890, 105: 0.999970,
  106: 0.999990, 107: 1.000000, 108: 1.000000, 109: 1.000000, 110: 1.000000
};

/**
 * RV-M-2020: Tabla de mortalidad para Renta Vitalicia Mujeres
 * Causantes no inválidas (para pensionados por vejez)
 * Nota: Inicia en edad 20
 */
export const TABLA_RV_M_2020: Record<number, number> = {
  20: 0.000300, 21: 0.000306, 22: 0.000316, 23: 0.000328, 24: 0.000341,
  25: 0.000355, 26: 0.000371, 27: 0.000388, 28: 0.000407, 29: 0.000427,
  30: 0.000449, 31: 0.000473, 32: 0.000500, 33: 0.000529, 34: 0.000561,
  35: 0.000597, 36: 0.000636, 37: 0.000679, 38: 0.000726, 39: 0.000777,
  40: 0.000832, 41: 0.000891, 42: 0.000954, 43: 0.001021, 44: 0.001092,
  45: 0.001168, 46: 0.001250, 47: 0.001339, 48: 0.001436, 49: 0.001543,
  50: 0.001661, 51: 0.001790, 52: 0.001931, 53: 0.002083, 54: 0.002247,
  55: 0.002424, 56: 0.002614, 57: 0.002818, 58: 0.003038, 59: 0.003276,
  60: 0.003535, 61: 0.003819, 62: 0.004132, 63: 0.004477, 64: 0.004857,
  65: 0.005273, 66: 0.005725, 67: 0.006214, 68: 0.006740, 69: 0.007304,
  70: 0.007909, 71: 0.008562, 72: 0.009272, 73: 0.010048, 74: 0.010901,
  75: 0.011842, 76: 0.012882, 77: 0.014029, 78: 0.015290, 79: 0.016670,
  80: 0.018175, 81: 0.019809, 82: 0.021577, 83: 0.023484, 84: 0.025537,
  85: 0.027750, 86: 0.030138, 87: 0.032720, 88: 0.035517, 89: 0.038553,
  90: 0.041855, 91: 0.045454, 92: 0.049381, 93: 0.053669, 94: 0.058351,
  95: 0.063463, 96: 0.069041, 97: 0.075124, 98: 0.081748, 99: 0.088953,
  100: 0.096778, 101: 0.105265, 102: 0.114454, 103: 0.124388, 104: 0.135108,
  105: 0.146659, 106: 0.159082, 107: 0.172420, 108: 0.186715, 109: 0.202007,
  110: 1.000000
};

// ==========================================
// TASAS DE RENTAS VITALICIAS POR COMPAÑÍA
// ==========================================

export interface TasasCompania {
  vejez: number;
  vejez_anticipada: number;
  invalidez_total: number;
  invalidez_parcial: number | null;
  sobrevivencia: number;
  media: number;
}

export const TASAS_RENTAS_VITALICIAS: Record<string, TasasCompania> = {
  'Media Mercado': {
    vejez: 0.0279,
    vejez_anticipada: 0.0282,
    invalidez_total: 0.0296,
    invalidez_parcial: 0.0260,
    sobrevivencia: 0.0288,
    media: 0.0282
  },
  '4LIFE': {
    vejez: 0.0298,
    vejez_anticipada: 0.0303,
    invalidez_total: 0.0303,
    invalidez_parcial: null,
    sobrevivencia: 0.0301,
    media: 0.0298
  },
  'AUGUSTAR': {
    vejez: 0.0299,
    vejez_anticipada: 0.0296,
    invalidez_total: 0.0341,
    invalidez_parcial: null,
    sobrevivencia: 0.0309,
    media: 0.0299
  },
  'BICE': {
    vejez: 0.0256,
    vejez_anticipada: 0.0273,
    invalidez_total: 0.0278,
    invalidez_parcial: 0.0265,
    sobrevivencia: 0.0256,
    media: 0.0262
  },
  'CN LIFE': {
    vejez: 0.0287,
    vejez_anticipada: 0.0287,
    invalidez_total: 0.0304,
    invalidez_parcial: null,
    sobrevivencia: 0.0309,
    media: 0.0296
  },
  'CONFUTURO': {
    vejez: 0.0291,
    vejez_anticipada: 0.0285,
    invalidez_total: 0.0298,
    invalidez_parcial: 0.0246,
    sobrevivencia: 0.0293,
    media: 0.0291
  },
  'CONSORCIO NACIONAL': {
    vejez: 0.0264,
    vejez_anticipada: 0.0277,
    invalidez_total: 0.0309,
    invalidez_parcial: 0.0250,
    sobrevivencia: 0.0295,
    media: 0.0277
  },
  'EUROAMERICA': {
    vejez: 0.0292,
    vejez_anticipada: 0.0300,
    invalidez_total: 0.0296,
    invalidez_parcial: null,
    sobrevivencia: 0.0282,
    media: 0.0293
  },
  'METLIFE': {
    vejez: 0.0262,
    vejez_anticipada: 0.0272,
    invalidez_total: 0.0296,
    invalidez_parcial: 0.0205,
    sobrevivencia: 0.0290,
    media: 0.0274
  },
  'PENTA': {
    vejez: 0.0288,
    vejez_anticipada: 0.0291,
    invalidez_total: 0.0296,
    invalidez_parcial: 0.0282,
    sobrevivencia: 0.0290,
    media: 0.0289
  },
  'SANTANDER': {
    vejez: 0.0290,
    vejez_anticipada: 0.0302,
    invalidez_total: 0.0310,
    invalidez_parcial: 0.0267,
    sobrevivencia: 0.0297,
    media: 0.0288
  }
};

// ==========================================
// TASAS DE DESCUENTO (SPOT RATE OCT 2025)
// ==========================================

export const TASAS_DESCUENTO_SR_2025: Record<number, number> = {
  1: 0.0197, 2: 0.0248, 3: 0.0277, 4: 0.0292, 5: 0.0301,
  6: 0.0306, 7: 0.0309, 8: 0.0310, 9: 0.0311, 10: 0.0311,
  11: 0.0311, 12: 0.0310, 13: 0.0309, 14: 0.0308, 15: 0.0307,
  16: 0.0306, 17: 0.0305, 18: 0.0304, 19: 0.0303, 20: 0.0303,
  21: 0.0302, 22: 0.0301, 23: 0.0300, 24: 0.0299, 25: 0.0298,
  26: 0.0297, 27: 0.0296, 28: 0.0295, 29: 0.0294, 30: 0.0292
};

// ==========================================
// FUNCIONES AUXILIARES
// ==========================================

/**
 * Obtiene la tabla de mortalidad apropiada según contexto
 */
export function obtenerTablaMortalidad(
  sexo: 'M' | 'F',
  tipoPension: 'vejez' | 'invalidez' | 'sobrevivencia',
  modalidad?: 'retiro_programado' | 'renta_vitalicia'
): Record<number, number> {
  if (tipoPension === 'invalidez') {
    return sexo === 'M' ? TABLA_MI_H_2020 : TABLA_MI_M_2020;
  }
  
  if (sexo === 'M') {
    return TABLA_CB_H_2020;
  }
  
  // Para mujeres: usar RV-M-2020 si es renta vitalicia, B-M-2020 si es retiro programado
  if (modalidad === 'renta_vitalicia' && tipoPension === 'vejez') {
    return TABLA_RV_M_2020;
  }
  
  return TABLA_B_M_2020;
}

/**
 * Obtiene tasa de interés según compañía y tipo de pensión
 */
export function obtenerTasaRentasVitalicias(
  compania: string,
  tipoPension: 'vejez' | 'invalidez' | 'sobrevivencia'
): number {
  const tasas = TASAS_RENTAS_VITALICIAS[compania] || TASAS_RENTAS_VITALICIAS['Media Mercado'];
  
  switch (tipoPension) {
    case 'vejez':
      return tasas.vejez;
    case 'invalidez':
      return tasas.invalidez_total;
    case 'sobrevivencia':
      return tasas.sobrevivencia;
    default:
      return tasas.media;
  }
}

/**
 * Obtiene tasa de descuento interpolada para un plazo dado
 */
export function obtenerTasaDescuento(plazoAnos: number): number {
  if (plazoAnos <= 1) return TASAS_DESCUENTO_SR_2025[1];
  if (plazoAnos >= 30) return TASAS_DESCUENTO_SR_2025[30];
  
  const plazoInferior = Math.floor(plazoAnos);
  const plazoSuperior = Math.ceil(plazoAnos);
  
  if (plazoInferior === plazoSuperior) {
    return TASAS_DESCUENTO_SR_2025[plazoInferior] || 0.03;
  }
  
  const tasaInferior = TASAS_DESCUENTO_SR_2025[plazoInferior] || 0.03;
  const tasaSuperior = TASAS_DESCUENTO_SR_2025[plazoSuperior] || 0.03;
  
  // Interpolación lineal
  const factor = plazoAnos - plazoInferior;
  return tasaInferior + factor * (tasaSuperior - tasaInferior);
}

/**
 * Lista de compañías de seguros disponibles
 */
export const COMPANIAS_SEGUROS = Object.keys(TASAS_RENTAS_VITALICIAS);
